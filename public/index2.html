<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Centered Flex Row Zoom + Hygraph</title>
  <style>
    * {
      box-sizing: border-box;
    }

    @font-face {
      font-family: "Ufficio600";
      src:
        url("/fonts/Ufficio-500.woff2") format("woff2"),
        url("/fonts/Ufficio-500.woff") format("woff");
      font-style: normal;
      font-display: swap;
    }
    ::-webkit-scrollbar {
      display: none;
    }

    body {
      margin: 0;
      min-height: 3000vh; /* serve altezza per poter scrollare in verticale */
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgb(233, 245, 255);
      color: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      gap: 10rem;
      animation: backgroundIndex .6s ease 1.6s forwards;
    }

    @keyframes backgroundIndex {
      to {
        background: white;
      }
    }

    a{
      text-decoration: none;
      color: black;
      opacity:1;
      font-family: 'Ufficio600';
    }

    .frame {
      width: 100vw;
      overflow: visible;
      background: transparent;
      border-radius: 0;
      border: none;
      position: fixed;
      top: 0vh;
      transform-origin: top;
      animation: bottomMov 1s ease 1.5s forwards;
    }

    .fabioMenu{
      position: relative;
      display: flex;
      top: -2.6vw;
      width: 100%;
      transition: top 0.3s ease;
      box-shadow: 0px 1px 1px transparent;
      opacity: 0;
      animation: opacityIndex .6s ease-out 1.6s forwards;
    }

    .divMenu {
      width: 16.66%;
      font-size: 12px;
      opacity: 1;
    }

    .divMenu a{
      transition: opacity .4s ease;
    }

    .divMenuRight {
      position: absolute;
      right: 0;
      font-size: 12px;
      text-align: end;
    }

    @keyframes bottomMov {
      to {
        top: calc(60vh - 15px)
      }
    }

    .frame.zoomed {
      overflow: hidden;
      border-radius: 16px;
    }

    .row {
        height: 100vH;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1500px;
      padding: 12px;
      padding-bottom: 5px;
      overflow-x: auto;
      overscroll-behavior-x: auto;
      animation: inlineGap .9s ease-out 0.2s forwards;
    }

    @keyframes inlineGap {
      to {
        gap: 5px;
      }
    }

    .LogoIndex{
      opacity:0;
      animation: opacityIndex .6s ease-out 1.6s forwards;
    }

    @keyframes opacityIndex {
      to {
        opacity: 1;
      }
    }

    .row.zoomed {
      overflow-x: auto;
      gap: 48px;
      padding: 24px;
      padding-bottom: 5px;
    }

    .row::-webkit-scrollbar {
      display: none;
    }
    .row::-webkit-scrollbar-track {
      background: none;
    }
    .row::-webkit-scrollbar-thumb {
      background: none;
    }

    .row img {
      flex: 0 0 auto;
      height: 10vh; /* small size */
      object-fit: cover;
      opacity: 0;
      animation:
        TallIndex 1s ease 1.2s forwards,
        opacityIndex .9s ease-out 0.2s forwards;
      transform-origin: top;
      filter: none;
      transition: filter 0.3s ease;
      /* aggiungo transition per il translateY iniziale -> 0 */
      /* transition per transform viene impostata anche inline via JS per ritardi randomici */
    }
    @keyframes TallIndex {
      to {
        height: 40vh;
      }
    }

    .socials {
      top: 57vH;
      width: 100%;
      position: fixed;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 8px;
      padding-left: 15px;
      font-family: "Ufficio600";
      font-size: .7em;
      transition: .3s;
      transition-delay: .6s;
      opacity: 0;
      animation: opacityAnimation .4s ease-out 3s forwards;
    }

    @keyframes opacityAnimation {
      to {
        opacity: 1;
      }
    }

    .socials .copy {
      position: absolute;
      right: 15px;
    }

    /* quando una QUALSIASI img è in hover, tutte bright 0.7 */
    .row:has(img:hover) img {
      overflow: clip;
      filter: brightness(0.7);
    }

    /* tranne quella sotto il mouse */
    .row:has(img:hover) img:hover {
      filter: none;
    }

    .row.zoomed img {
      height: 42vh; /* zoomed size */
    }

    /* social hover opacity behavior (kept) */
    .socials a {
      cursor:pointer;
      opacity: 1;
      transition: opacity 0.4s ease;
    }

    /* quando qualunque <a> è in hover → tutti a .2 */
    .socials:has(a:hover) a {
      opacity: 0.2;
    }

    /* tranne QUELLO sotto il mouse */
    .socials a:hover {
      opacity: 1 !important;
    }
  </style>
</head>
<body>
  <div style="position: fixed; top:0; left:0;padding: 10px;padding-inline: 15px;width: 100%;">
    <img src="../Asset4.svg" class="LogoIndex" />
    <div style="z-index: 999999;" class='fabioMenu' >
      <div class="divMenu">
        <a href="/info">INFO</a>
      </div>
      <div class="divMenu">
        <a href="https://cwkshop-2.myshopify.com/">SHOP</a>
      </div>
      <div class="divMenu">
        <!-- archive intentionally non-clickable -->
        <a style="cursor:default" class="archive">ARCHIVE</a>
      </div>
      <div class="divMenu divMenuRight">
        <a href="/subscribe">SUBSCRIBE</a>
      </div>
    </div>
  </div>

  <div style="background-color: red;height: 100px;width: 15px;">ciao</div>

  <!-- social links: give them IDs so JS can populate hrefs -->
  <div class="socials">
    <a id="instagram" style="margin-right:10px" href="#" aria-disabled="true">INSTAGRAM</a>
    <a id="youtube" style="margin-right:10px" href="#" aria-disabled="true">YOUTUBE</a>

    <p class="copy">©2025 Clare Waight Keller</p>
  </div>

  <div class="frame" id="frame">
    <div class="row" id="row">
      <!-- images injected from Hygraph -->
    </div>
  </div>

  <script>
    const HYGRAPH_ENDPOINT = "https://eu-west-2.cdn.hygraph.com/content/cmgfdcv2n007j07w3p805x60q/master";

    const QUERY = `
      query HomePages {
        homePages(first: 1, orderBy: updatedAt_DESC) {
          logoDesktop { url }
          logoMobile  { url }
          images (first:100){ id url }
          instagram
          threads
          x
          youtube
          copyright
        }
      }
    `;

    const row = document.getElementById("row");
    const frame = document.getElementById("frame");

    async function loadImagesAndLinks() {
      try {
        const res = await fetch(HYGRAPH_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ query: QUERY })
        });

        if (!res.ok) {
          console.error("Hygraph HTTP error:", res.status, res.statusText);
          return;
        }

        const json = await res.json();

        if (!json.data || !json.data.homePages || json.data.homePages.length === 0) {
          console.error("No homePages data from Hygraph", json);
          return;
        }

        const home = json.data.homePages[0];

        // --- IMAGES ---
        const images = home.images || [];
        row.innerHTML = "";
        const fragment = document.createDocumentFragment();

        for (let repeat = 0; repeat < 17; repeat++) {
          images.forEach((imgObj) => {
            if (!imgObj || !imgObj.url) return;
            const img = document.createElement("img");
            img.src = imgObj.url;
            img.alt = imgObj.id || "";

            // --- RANDOM translateY start and random transition delay ---
            // randomY: range -250px .. +250px (start position)
            const randomY = Math.floor(Math.random() * 501) - 250;
            // random delay between 0 and 0.6s for a subtle stagger
            const randomDelay = '1s';

            // set initial transform so the image starts offset
            img.style.transform = `translateY(${randomY}px)`;
            // set a transform transition with the random delay
            img.style.transition = `transform 0.9s cubic-bezier(.22,.9,.28,1) ${randomDelay}, filter 0.3s ease 0s`;

            fragment.appendChild(img);
          });
        }
        row.appendChild(fragment);

        // trigger the translateY -> 0 animation on next frame
        // (use requestAnimationFrame to ensure initial styles are applied first)
        requestAnimationFrame(() => {
          const imgs = row.querySelectorAll("img");
          imgs.forEach((img) => {
            // Force reflow for safety (usually not needed but keeps things robust)
            // eslint-disable-next-line no-unused-expressions
            img.offsetHeight;
            // animate to final position
            img.style.transform = "translateY(0)";
            // make sure opacity animation still runs (existing CSS handles it)
          });
        });

        // --- SOCIAL LINKS ---
        // Helper to safely set a link (or disable it if missing)
        function setSocialLink(id, url, label) {
          const el = document.getElementById(id);
          if (!el) return;
          if (url && url.trim()) {
            el.setAttribute("href", url);
            el.setAttribute("target", "_blank");
            el.setAttribute("rel", "noopener noreferrer");
            el.removeAttribute("aria-disabled");
            el.textContent = label; // keep label consistent
          } else {
            el.setAttribute("href", "#");
            el.setAttribute("aria-disabled", "true");
            el.removeAttribute("target");
            el.removeAttribute("rel");
          }
        }

        setSocialLink("instagram", home.instagram, "INSTAGRAM");
        setSocialLink("youtube", home.youtube, "YOUTUBE");
        setSocialLink("threads", home.threads, "THREADS");
        setSocialLink("x", home.x, "X");

        // update copyright if present
        if (home.copyright) {
          const copy = document.querySelector(".socials .copy");
          if (copy) copy.textContent = home.copyright;
        }

      } catch (err) {
        console.error("Error fetching from Hygraph:", err);
      }
    }

    // collega scroll verticale → scroll orizzontale (sensibilità standard)
    function setupVerticalToHorizontalScroll() {
      function updateHorizontalScroll() {
        const maxScrollY =
          document.documentElement.scrollHeight - window.innerHeight;
        const maxScrollX = row.scrollWidth - row.clientWidth;

        if (maxScrollY <= 0 || maxScrollX <= 0) return;

        const ratio = window.scrollY / maxScrollY; // 0 → top, 1 → bottom
        row.scrollLeft = maxScrollX * ratio;
      }

      window.addEventListener("scroll", updateHorizontalScroll);
      updateHorizontalScroll();
    }

    // menu opacity behavior (hover dims others)
    function setupMenuHoverDim() {
      const links = document.querySelectorAll(".fabioMenu a");
      links.forEach(link => {
        link.addEventListener("mouseenter", () => {
          links.forEach(l => {
            if (l !== link) l.style.opacity = "0.2";
          });
        });

        link.addEventListener("mouseleave", () => {
          links.forEach(l => {
            l.style.opacity = "1";
          });
        });
      });
    }

    // archive "COMING SOON" on hover
    function setupArchiveComingSoon() {
      const archiveLink = document.querySelector('.archive');
      if (archiveLink) {
        const originalText = archiveLink.textContent;
        archiveLink.addEventListener("mouseenter", () => {
          archiveLink.textContent = "COMING SOON";
        });
        archiveLink.addEventListener("mouseleave", () => {
          archiveLink.textContent = originalText;
        });
      }
    }

    window.addEventListener("load", () => {
      loadImagesAndLinks().then(() => {
        setupVerticalToHorizontalScroll();
        setupMenuHoverDim();
        setupArchiveComingSoon();
      });
    });
  </script>
</body>
</html>
